version: "0.29.0"

definitions:
  selector:
    type: RecordSelector
    extractor:
      type: DpathExtractor
      field_path: ["content"]

  requester:
    type: HttpRequester
    url_base: "https://app.avniproject.org/api"
    http_method: "GET"
    authenticator:
      type: "ApiKeyAuthenticator"
      header: "auth-token"
      api_token: "{{config['ApiToken']}}"
    request_parameters:
      lastModifiedDateTime: "{{config['lastModifiedDateTime']}}"

  retriever:
    type: SimpleRetriever
    record_selector:
      $ref: "#/definitions/selector"
    paginator:
      type: "DefaultPaginator"
      page_size_option:
        type: "RequestOption"
        inject_into: "request_parameter"
        field_name: "page_size"
      pagination_strategy:
        type: "PageIncrement"
        page_size: 20
      page_token_option:
        type: "RequestOption"
        inject_into: "request_parameter"
        field_name: "page"

    requester:
      $ref: "#/definitions/requester"

  base_stream:
    type: DeclarativeStream
    retriever:
      $ref: "#/definitions/retriever"
  subjects_stream:
    $ref: "#/definitions/base_stream"
    name: "subjects"
    primary_key: "ID"
    $parameters:
      path: "/subjects"



streams:
  - "#/definitions/subjects_stream"

check:
  type: CheckStream
  stream_names:
    - "subjects"


spec:
  type: Spec
  documentation_url: https://docs.airbyte.com/integrations/sources/avni
  connection_specification:
    title: Avni Spec
    type: object
    required:
      - ApiToken
      - lastModifiedDateTime
    additionalProperties: true
    properties:
      ApiToken:
        type: string
        description: Your avni platform Username
      lastModifiedDateTime:
        type: string
        default: "2000-06-23T01:30:00.000Z"
        description: Specify Date and time from which you want to fetch data
        examples:
          - "2000-10-31T01:30:00.000Z"